{"body": "<div class=\"section\" id=\"change-the-admin-widget-of-a-field\">\n<h1>Change the admin widget of a field<a class=\"headerlink\" href=\"#change-the-admin-widget-of-a-field\" title=\"Permalink to this headline\">\u00b6</a></h1>\n<a name=\"bd33cb189d9986ef085250830616f3af2845728e\"></a><p class=\"cn\" id=\"bd33cb189d9986ef085250830616f3af2845728e\">Django TinyMCE allows you to add TinyMCE functionality to your app if you make certain modifications to your app. This is great if it is your code. However, it doesn\u2019t work so well, if it is someone else\u2019s code. Justin forked Django-TinyMCE to provide this lazy customization. <a href=\"#id1\"><span class=\"problematic\" id=\"id2\">**</span></a>* The configuration is simple: the app.model name is the key, and then value is a list of fields to have TinyMCE on in the admin.</p>\n<div class=\"highlight-python\"><div class=\"highlight\"><pre><span class=\"n\">TINYMCE_ADMIN_FIELDS</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n    <span class=\"s\">&#39;app1.model1&#39;</span><span class=\"p\">:</span> <span class=\"p\">(</span><span class=\"s\">&#39;body&#39;</span><span class=\"p\">,),</span>\n    <span class=\"s\">&#39;app1.model2&#39;</span><span class=\"p\">:</span> <span class=\"p\">(</span><span class=\"s\">&#39;blog_text&#39;</span><span class=\"p\">,</span> <span class=\"s\">&#39;blog_teaser&#39;</span><span class=\"p\">)</span>\n<span class=\"p\">}</span>\n</pre></div>\n</div>\n<a name=\"5891a0a9ceac1c5397c2c95a10c076848a069762\"></a><p class=\"cn\" id=\"5891a0a9ceac1c5397c2c95a10c076848a069762\">There are several steps to this process. <a href=\"#id3\"><span class=\"problematic\" id=\"id4\">**</span></a>* The first is creating a REGISTRY variable to hold the Model and field specifications in our settings.py</p>\n<div class=\"highlight-python\"><pre>from django.db.models import get_model\nimport django.conf import settings\n\nREGISTRY = {}\nADMIN_FIELDS = getattr(settings, 'TINYMCE_ADMIN_FIELDS', {})\n\nfor model_name, field in ADMIN_FIELDS.items():\n    if isinstance(model_name, basestring):\n        model = get_model(*model_name.split('.'))\n        if model in registry:\n            return\n        REGISTRY[model] = field</pre>\n</div>\n<a name=\"ffb14c2618b02548efb8f7a79d89830e36620ea4\"></a><p class=\"cn\" id=\"ffb14c2618b02548efb8f7a79d89830e36620ea4\">Next in out admin.py, we declare a Model admin class, with one new attribute: editor_fields. We are also going to override a standard model admin method: <strong>* formfield for dbfield. This is the method that given a database field will return the form field to render. *</strong> our overridden method checks to see if this field is in our list of editor_fields, and if so, returns a version using the TinyMCE widget. <a href=\"#id5\"><span class=\"problematic\" id=\"id6\">**</span></a>* if the field is not in our list, we punt it back to the super class.</p>\n<a name=\"bbeb6a9e19f1e2af76ab2504fce592a2127e01b6\"></a><p class=\"cn\" id=\"bbeb6a9e19f1e2af76ab2504fce592a2127e01b6\"><tt class=\"docutils literal\"><span class=\"pre\">admin.py</span></tt></p>\n<div class=\"highlight-python\"><div class=\"highlight\"><pre><span class=\"c\"># Define a new ModelAdmin subclass</span>\n\n<span class=\"k\">class</span> <span class=\"nc\">TinyMCEAdmin</span><span class=\"p\">(</span><span class=\"n\">admin</span><span class=\"o\">.</span><span class=\"n\">ModelAdmin</span><span class=\"p\">):</span>\n    <span class=\"n\">editor_fields</span> <span class=\"o\">=</span> <span class=\"p\">()</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">formfield_for_dbfield</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">db_field</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n        <span class=\"k\">if</span> <span class=\"n\">db_field</span><span class=\"o\">.</span><span class=\"n\">name</span> <span class=\"ow\">in</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">editor_fields</span><span class=\"p\">:</span>\n            <span class=\"k\">return</span> <span class=\"n\">db_field</span><span class=\"o\">.</span><span class=\"n\">formfield</span><span class=\"p\">(</span><span class=\"n\">widget</span><span class=\"o\">=</span><span class=\"n\">TinyMCE</span><span class=\"p\">())</span>\n        <span class=\"k\">return</span> <span class=\"nb\">super</span><span class=\"p\">(</span><span class=\"n\">TinyMCEAdmin</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">formfield_for_dbfield</span><span class=\"p\">(</span>\n            <span class=\"n\">db_field</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<a name=\"d5d923864e5e71e8d9d6a1dd6543ad5d2f236240\"></a><p class=\"cn\" id=\"d5d923864e5e71e8d9d6a1dd6543ad5d2f236240\">Finally, we put the two pieces together. At the bottom of admin.py we loop through the admin\u2019s current admin registry. <strong>* Check if the current iteration is in our registry *</strong> if it is, we unregister that model\u2019s current admin <strong>* and then re-register the model with a dynamically-created class called newadmin *</strong> that is a subclass of our previously declared admin and the model\u2019s current admin <a href=\"#id7\"><span class=\"problematic\" id=\"id8\">**</span></a>* and we set that new class\u2019s editor-fields attribute to the fields in our registry</p>\n<a name=\"c27c7f2581b51e561749abf5d92ac087d2cbdd49\"></a><p class=\"cn\" id=\"c27c7f2581b51e561749abf5d92ac087d2cbdd49\"><tt class=\"docutils literal\"><span class=\"pre\">admin.py</span></tt></p>\n<dl class=\"docutils\">\n<dt>for model, modeladmin in admin.site._registry.items():</dt>\n<dd><dl class=\"first last docutils\">\n<dt>if model in REGISTRY:</dt>\n<dd><a name=\"742c792133af43d32eff074c99faaa11625b7d3e\"></a><p class=\"first cn\" id=\"742c792133af43d32eff074c99faaa11625b7d3e\">admin.site.unregister(model)\nadmin.site.register(</p>\n<blockquote class=\"cn\" id=\"8\">\n<div><a name=\"8450dbeeb3f9a123a5b3d8a98c36c89d43aff2d0\"></a><p class=\"cn\" id=\"8450dbeeb3f9a123a5b3d8a98c36c89d43aff2d0\">model,\ntype('newadmin',</p>\n<blockquote class=\"cn\" id=\"10\">\n<div><a name=\"0f8068a674a53adb69ceb55fc9502870eaf0db8e\"></a><p class=\"cn\" id=\"0f8068a674a53adb69ceb55fc9502870eaf0db8e\">(TinyMCEAdmin, modeladmin.__class__),\n{'editor_fields': REGISTRY[model],}</p>\n</div></blockquote>\n<a name=\"de7a13fe03ed57f2b002eea7b85a0924519bc52c\"></a><p class=\"cn\" id=\"de7a13fe03ed57f2b002eea7b85a0924519bc52c\">)</p>\n</div></blockquote>\n<a name=\"df280c9581ef6c68a0ae8297397b5c946584d142\"></a><p class=\"last cn\" id=\"df280c9581ef6c68a0ae8297397b5c946584d142\">)</p>\n</dd>\n</dl>\n</dd>\n</dl>\n</div>\n", "display_toc": false, "title": "Change the admin widget of a field", "sourcename": "decorator_apps/change_the_admin_widget.txt", "customsidebar": null, "current_page_name": "decorator_apps/change_the_admin_widget", "next": {"link": "../lazy_field_insertion/", "title": "Lazy Field Insertion"}, "rellinks": [["genindex", "General Index", "I", "index"], ["decorator_apps/lazy_field_insertion", "Lazy Field Insertion", "N", "next"], ["decorator_apps/add_fieldsets_to_model_admin", "Adding fieldsets to a model's admin", "P", "previous"]], "meta": {}, "parents": [{"link": "../", "title": "Decorator App Patterns"}], "sidebars": null, "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">Change the admin widget of a field</a></li>\n</ul>\n", "prev": {"link": "../add_fieldsets_to_model_admin/", "title": "Adding fieldsets to a model's admin"}, "metatags": ""}