
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Change the admin widget of a field &mdash; Django Patterns</title>
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Django Patterns" href="../index.html" />
    <link rel="up" title="Decorator App Patterns" href="index.html" />
    <link rel="next" title="Lazy Field Insertion" href="lazy_field_insertion.html" />
    <link rel="prev" title="Adding fieldsets to a model’s admin" href="add_fieldsets_to_model_admin.html" /> 
  </head>
  <body>
<div id="docstitle">
	<p>Django Patterns</p>
</div>
<div id="header">
	<div id="title"><h1>Change the admin widget of a field</h1></div>
	<ul id="headerButtons">
		<li id="toc_button"><div class="headerButton"><a href="#">Table of Contents</a></div></li>
		<li id="page_buttons">
			<div class="headerButton"><a href="../genindex.html" title="General Index" accesskey="I">index</a></div>
			<div class="headerButton"><a href="lazy_field_insertion.html" title="Lazy Field Insertion" accesskey="N">next</a></div>
			<div class="headerButton"><a href="add_fieldsets_to_model_admin.html" title="Adding fieldsets to a model’s admin" accesskey="P">previous</a></div>
		</li>
	</ul>
</div>

<div id="sphinxsidebar">
  <div class="sphinxsidebarwrapper">
	<ul><li class="toctree-l1"><a href="../index.html">Main Page</a></li></ul>
	<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../what_are_pluggable_apps.html">What are pluggable apps?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development_philosophy.html">My Development Assumptions and Principles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../app_construction/index.html">Application Construction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/index.html">Configuration Patterns</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Decorator App Patterns</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="add_fieldsets_to_model_admin.html">Adding fieldsets to a model&#8217;s admin</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Change the admin widget of a field</a></li>
<li class="toctree-l2"><a class="reference internal" href="lazy_field_insertion.html">Lazy Field Insertion</a></li>
<li class="toctree-l2"><a class="reference internal" href="lazy_manager_insertion.html">Lazy Manager Insertion</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../models/index.html">Model Patterns</a></li>
<li class="toctree-l1"><a class="reference internal" href="../templates/index.html">Template Patterns</a></li>
<li class="toctree-l1"><a class="reference internal" href="../urls/index.html">URL patterns</a></li>
</ul>

    <div id="searchbox" style="display: none">
      
        <form class="search" action="../search.html" method="get">
			<div class="search-wrapper">
			<span class="search-left"></span>
			<input class="prettysearch" type="text" name="q" size="18" />
			<span class="search-right">&nbsp;</span>
			</div>
          <input type="submit" value="Search" class="searchbutton" />
          <input type="hidden" name="check_keywords" value="yes" />
          <input type="hidden" name="area" value="default" />
        </form>
        <p class="searchtip" style="font-size: 90%">
        Enter search terms or a module, class or function name.
        </p>
    </div>
    <script type="text/javascript">$('#searchbox').show(0);</script>
  </div>
</div>



    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="change-the-admin-widget-of-a-field">
<h1>Change the admin widget of a field<a class="headerlink" href="#change-the-admin-widget-of-a-field" title="Permalink to this headline">¶</a></h1>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<a name="49f37f1a29b47bf85ce3ac18e98d509847db43dd"></a><p class="last cn" id="49f37f1a29b47bf85ce3ac18e98d509847db43dd">This is just a stub document. It will be fleshed out more. Please don&#8217;t comment on it.</p>
</div>
<a name="80e73e28c9c94cc309bcbcdeeded3afca2e75755"></a><p class="cn" id="80e73e28c9c94cc309bcbcdeeded3afca2e75755">Django TinyMCE allows you to add TinyMCE functionality to your app if you make certain modifications to your app. This is great if it is your code. However, it doesn’t work so well, if it is someone else’s code. Justin forked Django-TinyMCE to provide this lazy customization.</p>
<a name="6c3db5a1afc7cfd6fe4540d3ed03d5d5a2c68355"></a><p class="cn" id="6c3db5a1afc7cfd6fe4540d3ed03d5d5a2c68355">The configuration is simple: the app.model name is the key, and then value is a list of fields to have TinyMCE on in the admin.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">TINYMCE_ADMIN_FIELDS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;app1.model1&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;body&#39;</span><span class="p">,),</span>
    <span class="s">&#39;app1.model2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;blog_text&#39;</span><span class="p">,</span> <span class="s">&#39;blog_teaser&#39;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<a name="37360b6d7c4e6399721b97304585f0e6fb497319"></a><p class="cn" id="37360b6d7c4e6399721b97304585f0e6fb497319">There are several steps to this process.</p>
<a name="97fc89514d793a710726879731c8db438e4b4885"></a><p class="cn" id="97fc89514d793a710726879731c8db438e4b4885">The first is creating a REGISTRY variable to hold the Model and field specifications in our settings.py</p>
<div class="highlight-python"><pre>from django.db.models import get_model
import django.conf import settings

REGISTRY = {}
ADMIN_FIELDS = getattr(settings, 'TINYMCE_ADMIN_FIELDS', {})

for model_name, field in ADMIN_FIELDS.items():
    if isinstance(model_name, basestring):
        model = get_model(*model_name.split('.'))
        if model in registry:
            return
        REGISTRY[model] = field</pre>
</div>
<a name="35a2960956d50f027b3b884db1bed9f0c3eac20b"></a><p class="cn" id="35a2960956d50f027b3b884db1bed9f0c3eac20b">Next in out admin.py, we declare a Model admin class, with one new attribute: editor_fields. We are also going to override a standard model admin method:</p>
<a name="31ffb404a7b22b304f73094be38629657a8db979"></a><p class="cn" id="31ffb404a7b22b304f73094be38629657a8db979">formfield for dbfield. This is the method that given a database field will return the form field to render.</p>
<a name="732a4cbbaa1e64ea640cf1719190e71666f0b0f6"></a><p class="cn" id="732a4cbbaa1e64ea640cf1719190e71666f0b0f6">our overridden method checks to see if this field is in our list of editor_fields, and if so, returns a version using the TinyMCE widget.</p>
<a name="2e12eca7588ec82915ebe08f5e06d57e6b75dce7"></a><p class="cn" id="2e12eca7588ec82915ebe08f5e06d57e6b75dce7">if the field is not in our list, we punt it back to the super class.</p>
<a name="7a13a100b69f723377a80a453bfd2e568d855a3b"></a><p class="cn" id="7a13a100b69f723377a80a453bfd2e568d855a3b"><tt class="docutils literal"><span class="pre">admin.py</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Define a new ModelAdmin subclass</span>

<span class="k">class</span> <span class="nc">TinyMCEAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">editor_fields</span> <span class="o">=</span> <span class="p">()</span>

    <span class="k">def</span> <span class="nf">formfield_for_dbfield</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_field</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">db_field</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor_fields</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">db_field</span><span class="o">.</span><span class="n">formfield</span><span class="p">(</span><span class="n">widget</span><span class="o">=</span><span class="n">TinyMCE</span><span class="p">())</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">TinyMCEAdmin</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">formfield_for_dbfield</span><span class="p">(</span>
            <span class="n">db_field</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<a name="3c2ce26f151fa0adf7dd3ee73cd3a91b5bb61507"></a><p class="cn" id="3c2ce26f151fa0adf7dd3ee73cd3a91b5bb61507">Finally, we put the two pieces together. At the bottom of admin.py we loop through the admin’s current admin registry.</p>
<a name="1de4010e13e584b903d2d668afec7e88b33f800a"></a><p class="cn" id="1de4010e13e584b903d2d668afec7e88b33f800a">Check if the current iteration is in our registry</p>
<a name="52a797cc93e41edba74845bd1f0146db60cf3509"></a><p class="cn" id="52a797cc93e41edba74845bd1f0146db60cf3509">if it is, we unregister that model’s current admin</p>
<a name="3f120eebc7ef4a89eea3ca07c90cfcf556f62c54"></a><p class="cn" id="3f120eebc7ef4a89eea3ca07c90cfcf556f62c54">and then re-register the model with a dynamically-created class called newadmin</p>
<a name="d1cdb876089c60fff7c087643eab7fb04adeac03"></a><p class="cn" id="d1cdb876089c60fff7c087643eab7fb04adeac03">that is a subclass of our previously declared admin and the model’s current admin</p>
<a name="2f002710a4997ef1d8d25d3fe5c4587532bf0335"></a><p class="cn" id="2f002710a4997ef1d8d25d3fe5c4587532bf0335">and we set that new class’s editor-fields attribute to the fields in our registry</p>
<a name="4d8726b934314d9511c04b3b0ca14e83f5ece04f"></a><p class="cn" id="4d8726b934314d9511c04b3b0ca14e83f5ece04f"><tt class="docutils literal"><span class="pre">admin.py</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">model</span><span class="p">,</span> <span class="n">modeladmin</span> <span class="ow">in</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">_registry</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">REGISTRY</span><span class="p">:</span>
        <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">unregister</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span>
            <span class="n">model</span><span class="p">,</span>
            <span class="nb">type</span><span class="p">(</span><span class="s">&#39;newadmin&#39;</span><span class="p">,</span>
                <span class="p">(</span><span class="n">TinyMCEAdmin</span><span class="p">,</span> <span class="n">modeladmin</span><span class="o">.</span><span class="n">__class__</span><span class="p">),</span>
                <span class="p">{</span><span class="s">&#39;editor_fields&#39;</span><span class="p">:</span> <span class="n">REGISTRY</span><span class="p">[</span><span class="n">model</span><span class="p">],}</span>
            <span class="p">)</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>


          </div> 
        </div>
      </div>
    <div class="footer">
    <p>
      &copy; Copyright 2011, Corey Oordt.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
	</p>
    </div>
      <div class="clearer"></div>
    </div>
	<div id="breadcrumbs">
		<a href="index.html" accesskey="U">Decorator App Patterns</a><img src="../_static/triangle_closed.png" height="9" width="9" alt="&gt;">
		Change the admin widget of a field
		</ul>
	</div>
	<script type="text/javascript" charset="utf-8" src="../_static/toc.js"></script>
  </body>
</html>